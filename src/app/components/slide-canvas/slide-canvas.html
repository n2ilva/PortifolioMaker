<div class="canvas-container">
  <div class="canvas-wrapper" [style.transform]="'scale(' + slideService.zoom() / 100 + ')'">
    @if (slideService.currentSlide(); as slide) {
      <div 
        #canvas
        class="canvas"
        [style.background-color]="slide.backgroundColor"
        (click)="onCanvasClick()"
      >
        <!-- Guias de Grade do Layout -->
        @if (slideService.showGridGuides()) {
          @for (guide of getLayoutGridGuides(slide.layoutId); track $index) {
            <div 
              class="layout-grid-guide"
              [style.left.%]="guide.x"
              [style.top.%]="guide.y"
              [style.width.%]="guide.width"
              [style.height.%]="guide.height"
            >
              <!-- Marcadores de canto -->
              <div class="grid-corner-marker top-left"></div>
              <div class="grid-corner-marker top-right"></div>
              <div class="grid-corner-marker bottom-left"></div>
              <div class="grid-corner-marker bottom-right"></div>
              <span class="grid-guide-label">{{ guide.label }}</span>
            </div>
          }
        }

        <!-- Linhas Guia de Alinhamento -->
        @for (guide of slideService.alignmentGuides(); track guide.position) {
          @if (guide.type === 'vertical') {
            <div 
              class="alignment-guide vertical"
              [style.left.%]="guide.position"
            ></div>
          } @else {
            <div 
              class="alignment-guide horizontal"
              [style.top.%]="guide.position"
            ></div>
          }
        }

        @for (element of slide.elements; track element.id) {
          <div 
            class="element"
            [class.selected]="element.id === slideService.selectedElementId() && !isBackgroundImage(element)"
            [class.hovered]="element.id === hoveredElementId && !isBackgroundImage(element)"
            [class.background-element]="isBackgroundImage(element)"
            [ngStyle]="getElementStyle(element)"
            (mousedown)="!isBackgroundImage(element) && onMouseDown($event, element)"
            (click)="!isBackgroundImage(element) && onElementClick($event, element)"
            (mouseenter)="!isBackgroundImage(element) && onElementMouseEnter($event, element)"
            (mouseleave)="!isBackgroundImage(element) && onElementMouseLeave($event, element)"
          >
            <!-- Indicador de Proporção Padrão -->
            @if (element.id === hoveredElementId && hasStandardAspectRatio() && isImage(element) && !isBackgroundImage(element)) {
              <div class="aspect-ratio-badge">
                <span class="aspect-ratio-icon material-icons">{{ getAspectRatioInfo()?.icon }}</span>
                <span class="aspect-ratio-name">{{ getAspectRatioInfo()?.name }}</span>
                <span class="aspect-ratio-desc">{{ getAspectRatioInfo()?.description }}</span>
              </div>
            }

            <!-- Elemento de Imagem -->
            @if (isImage(element)) {
              <div class="image-element">
                @if (asImage(element).src) {
                  <img 
                    [src]="asImage(element).src" 
                    alt="Imagem do slide"
                    [attr.alt]="asImage(element).alt || 'Imagem do slide'"
                    [attr.title]="asImage(element).alt || 'Imagem do slide'"
                    [ngStyle]="getImageStyle(asImage(element))"
                    draggable="false"
                  >
                } @else {
                  <div class="image-placeholder">
                    <span class="placeholder-icon material-icons">add_photo_alternate</span>
                    <span class="placeholder-text">Arraste uma imagem</span>
                  </div>
                }
              </div>
            }
            
            <!-- Elemento de Texto -->
            @if (isText(element)) {
              <div 
                class="text-element"
                [class.editing]="editingTextId === element.id"
                [ngStyle]="getTextStyle(asText(element))"
                [attr.contenteditable]="editingTextId === element.id ? 'true' : 'false'"
                (dblclick)="onTextDoubleClick($event, element)"
                (mousedown)="onTextMouseDown($event, element)"
                (blur)="onTextBlur($event, asText(element))"
                #textEl
              >{{ asText(element).content }}</div>
            }


            
            <!-- Handles de redimensionamento (quando selecionado) -->
            @if (element.id === slideService.selectedElementId()) {
              <div class="resize-handle nw" (mousedown)="onMouseDown($event, element, 'nw')"></div>
              <div class="resize-handle n" (mousedown)="onMouseDown($event, element, 'n')"></div>
              <div class="resize-handle ne" (mousedown)="onMouseDown($event, element, 'ne')"></div>
              <div class="resize-handle e" (mousedown)="onMouseDown($event, element, 'e')"></div>
              <div class="resize-handle se" (mousedown)="onMouseDown($event, element, 'se')"></div>
              <div class="resize-handle s" (mousedown)="onMouseDown($event, element, 's')"></div>
              <div class="resize-handle sw" (mousedown)="onMouseDown($event, element, 'sw')"></div>
              <div class="resize-handle w" (mousedown)="onMouseDown($event, element, 'w')"></div>
            }
          </div>
        }
      </div>
    } @else {
      <div class="no-slide">
        <p>Nenhum slide selecionado</p>
        <button (click)="slideService.createSlide()">Criar Slide</button>
      </div>
    }
  </div>
</div>

<!-- Controle de Zoom fixo abaixo do slide -->
<div class="zoom-controls-fixed">
  <button class="zoom-btn" (click)="onZoomOut()" title="Diminuir zoom">−</button>
  <span class="zoom-value">{{ slideService.zoom() }}%</span>
  <button class="zoom-btn" (click)="onZoomIn()" title="Aumentar zoom">+</button>
</div>
