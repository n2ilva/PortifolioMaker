<div class="toolbar">
  <div class="toolbar-left">
    <button class="logo-btn" (click)="onOpenProjects()" title="Meus Projetos">
      <span class="material-icons-round">folder_open</span>
    </button>
    <span class="logo">Portfólio Maker</span>
    
    <!-- Indicador do Projeto Atual -->
    <div class="project-indicator">
      @if (isEditingName) {
        <input 
          #projectNameInput
          type="text" 
          class="project-name-input"
          [value]="projectState.currentProjectName() || 'Novo Projeto'"
          (blur)="saveProjectName($event)"
          (keydown.enter)="saveProjectName($event)"
          (keydown.escape)="cancelEditName()"
        >
      } @else {
        <span 
          class="project-name" 
          (click)="startEditName()" 
          title="Clique para editar o nome do projeto"
        >
          {{ projectState.currentProjectName() || 'Novo Projeto' }}
          <span class="edit-icon material-icons-round">edit</span>
        </span>
      }
      @if (projectState.hasUnsavedChanges()) {
        <span class="save-status unsaved" title="Alterações não salvas - Clique para salvar" (click)="onSaveProject()">
          <span class="material-icons-round">circle</span>
        </span>
      } @else {
        <span class="save-status saved" title="Projeto salvo">
          <span class="material-icons-round">check_circle</span>
        </span>
      }
    </div>
  </div>

  <!-- Botão Menu Mobile -->
  <button class="mobile-menu-btn" (click)="toggleMobileMenu()">
    <span class="hamburger-icon" [class.open]="isMobileMenuOpen">
      <span></span>
      <span></span>
      <span></span>
    </span>
  </button>
  
  <!-- Menu Desktop -->
  <div class="toolbar-center desktop-only">
    <button class="btn btn-secondary" (click)="onImportBatch()">
      <span class="material-icons-round">auto_awesome</span> Importar Inteligente
    </button>
    
    <button class="btn" (click)="onAddImages()">
      <span class="material-icons-round">add_photo_alternate</span> Adicionar Fotos
    </button>
    <input 
      #fileInput
      type="file" 
      multiple 
      accept="image/*" 
      (change)="onFilesSelected($event)"
      class="hidden-input"
      title="Selecionar fotos"
    >

    <button class="btn" (click)="onAddText()">
      <span class="material-icons-round">text_fields</span> Adicionar Texto
    </button>
    
    <button class="btn" (click)="onNewSlide()">
      <span class="material-icons-round">add_to_photos</span> Novo Slide
    </button>
    
    <div class="separator"></div>
    
    <button 
      class="btn" 
      (click)="onAlignToGrid()"
      title="Alinhar todos os elementos na grade"
    >
      <span class="material-icons-round">grid_on</span> Alinhar à Grade
    </button>

    <button 
      class="btn"
      [class.btn-active]="slideService.showGridGuides()"
      (click)="onToggleGridGuides()"
      title="Mostrar/ocultar linhas de grade do layout"
    >
      <span class="material-icons-round">{{ slideService.showGridGuides() ? 'grid_view' : 'grid_off' }}</span> Grade
    </button>

    <div class="separator"></div>

    <button 
      class="btn btn-undo"
      (click)="undo()"
      [disabled]="!slideService.canUndo()"
      title="Desfazer última alteração (Ctrl+Z)"
    >
      <span class="material-icons-round">undo</span> Desfazer
    </button>
  </div>
  
  <div class="toolbar-right desktop-only">
    <button 
      class="btn btn-export-video" 
      (click)="onExportVideo()" 
      [disabled]="isExportingVideo"
      title="Exportar como vídeo"
    >
      @if (isExportingVideo) {
        <span class="material-icons-round spinning">autorenew</span>
        @if (videoExportProgress) {
          {{ videoExportProgress.progress }}%
        }
      } @else {
        <span class="material-icons-round">videocam</span> Vídeo
      }
    </button>
    <button class="btn btn-presentation" (click)="onStartPresentation()" title="Iniciar apresentação (F5)">
      <span class="material-icons-round">play_arrow</span> Apresentar
    </button>
  </div>
</div>

<!-- Modal de progresso de exportação de vídeo -->
@if (isExportingVideo && videoExportProgress) {
  <div class="video-export-modal">
    <div class="video-export-content">
      <div class="video-export-icon">
        @if (videoExportProgress.status === 'complete') {
          <span class="material-icons-round success">check_circle</span>
        } @else if (videoExportProgress.status === 'error') {
          <span class="material-icons-round error">error</span>
        } @else {
          <span class="material-icons-round spinning">videocam</span>
        }
      </div>
      <h3>Exportando Vídeo</h3>
      <p>{{ videoExportProgress.message }}</p>
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="videoExportProgress.progress"></div>
      </div>
      <span class="progress-text">{{ videoExportProgress.progress }}%</span>
    </div>
  </div>
}

<!-- Menu Mobile Dropdown -->
<div class="mobile-menu" [class.open]="isMobileMenuOpen">
  <div class="mobile-menu-overlay" (click)="closeMobileMenu()"></div>
  <div class="mobile-menu-content">
    <div class="mobile-menu-grid">
      <button class="mobile-menu-icon-btn" (click)="onOpenProjects(); closeMobileMenu()" title="Meus Projetos">
        <span class="material-icons-round">folder_open</span>
      </button>
      <button class="mobile-menu-icon-btn save" (click)="onSaveProject(); closeMobileMenu()" title="Salvar Projeto">
        <span class="material-icons-round">save</span>
      </button>
      <button class="mobile-menu-icon-btn" (click)="onImportBatch(); closeMobileMenu()" title="Importar Inteligente">
        <span class="material-icons-round">auto_awesome</span>
      </button>
      <button class="mobile-menu-icon-btn" (click)="onAddImages(); closeMobileMenu()" title="Adicionar Fotos">
        <span class="material-icons-round">add_photo_alternate</span>
      </button>
      <button class="mobile-menu-icon-btn" (click)="onAddText(); closeMobileMenu()" title="Adicionar Texto">
        <span class="material-icons-round">text_fields</span>
      </button>
      <button class="mobile-menu-icon-btn" (click)="onNewSlide(); closeMobileMenu()" title="Novo Slide">
        <span class="material-icons-round">add_to_photos</span>
      </button>
      <button class="mobile-menu-icon-btn" (click)="onAlignToGrid(); closeMobileMenu()" title="Alinhar à Grade">
        <span class="material-icons-round">grid_on</span>
      </button>
      <button 
        class="mobile-menu-icon-btn" 
        [class.active]="slideService.showGridGuides()"
        (click)="onToggleGridGuides()"
        [title]="slideService.showGridGuides() ? 'Ocultar Grade' : 'Mostrar Grade'"
      >
        <span class="material-icons-round">{{ slideService.showGridGuides() ? 'grid_view' : 'grid_off' }}</span>
      </button>
      <button class="mobile-menu-icon-btn" (click)="onExportVideo(); closeMobileMenu()" [disabled]="isExportingVideo" title="Exportar Vídeo">
        <span class="material-icons-round">videocam</span>
      </button>
      <button class="mobile-menu-icon-btn presentation" (click)="onStartPresentation(); closeMobileMenu()" title="Apresentar">
        <span class="material-icons-round">play_arrow</span>
      </button>
    </div>
  </div>
</div>
