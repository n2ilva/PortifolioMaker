<div class="sidebar">
  <!-- Tabs -->
  <div class="sidebar-tabs">
    <button 
      class="tab" 
      [class.active]="activeTab === 'slide'"
      (click)="setActiveTab('slide')"
    >
      Slide
    </button>
    <button 
      class="tab" 
      [class.active]="activeTab === 'element'"
      (click)="setActiveTab('element')"
      [disabled]="!selectedElement"
    >
      Elemento
    </button>
    <button 
      class="tab" 
      [class.active]="activeTab === 'layouts'"
      (click)="setActiveTab('layouts')"
    >
      Layouts
    </button>
  </div>

  <div class="sidebar-content">
    <!-- Tab: Layouts -->
    @if (activeTab === 'layouts') {
      <div class="panel">
        <h4>Layouts Pré-definidos</h4>
        <p class="panel-description">Clique para aplicar um layout ao slide atual</p>
        
        <div class="layouts-grid">
          @for (layout of sortedLayoutTemplates; track layout.id) {
            @if (layout.id !== 'layout-custom') {
              <div 
                class="layout-item"
                [class.active]="slideService.currentSlide()?.layoutId === layout.id"
                (click)="onApplyLayout(layout)"
                [title]="layout.name"
              >
                <div class="layout-icon">{{ getLayoutIcon(layout) }}</div>
              </div>
            }
          }
        </div>

        <!-- Grade Personalizada inline -->
        <div class="custom-grid-section">
          <h4>Grade Personalizada</h4>
          
          <div class="custom-grid-controls">
            <!-- Colunas e Linhas -->
            <div class="grid-control-row">
              <div class="grid-control-item">
                <label>Colunas</label>
                <div class="number-input-inline">
                  <button 
                    class="number-btn-small" 
                    (click)="decreaseColumns()"
                    [disabled]="customGridColumns <= 1"
                  >−</button>
                  <span class="number-value-small">{{ customGridColumns }}</span>
                  <button 
                    class="number-btn-small" 
                    (click)="increaseColumns()"
                    [disabled]="customGridColumns >= 6"
                  >+</button>
                </div>
              </div>

              <div class="grid-control-item">
                <label>Linhas</label>
                <div class="number-input-inline">
                  <button 
                    class="number-btn-small" 
                    (click)="decreaseRows()"
                    [disabled]="customGridRows <= 1"
                  >−</button>
                  <span class="number-value-small">{{ customGridRows }}</span>
                  <button 
                    class="number-btn-small" 
                    (click)="increaseRows()"
                    [disabled]="customGridRows >= 6"
                  >+</button>
                </div>
              </div>
            </div>

            <!-- Espaçamento -->
            <div class="grid-slider-row">
              <label>Espaçamento</label>
              <div class="slider-with-value">
                <input 
                  type="range" 
                  min="0" 
                  max="10" 
                  step="0.5"
                  [(ngModel)]="customGridGap"
                  class="grid-slider"
                >
                <span class="slider-value">{{ customGridGap }}%</span>
              </div>
            </div>

            <!-- Margem Horizontal -->
            <div class="grid-slider-row">
              <label>Margem Horizontal</label>
              <div class="slider-with-value">
                <input 
                  type="range" 
                  min="0" 
                  max="20" 
                  step="1"
                  [(ngModel)]="customGridMarginX"
                  class="grid-slider"
                >
                <span class="slider-value">{{ customGridMarginX }}%</span>
              </div>
            </div>

            <!-- Margem Vertical -->
            <div class="grid-slider-row">
              <label>Margem Vertical</label>
              <div class="slider-with-value">
                <input 
                  type="range" 
                  min="0" 
                  max="20" 
                  step="1"
                  [(ngModel)]="customGridMarginY"
                  class="grid-slider"
                >
                <span class="slider-value">{{ customGridMarginY }}%</span>
              </div>
            </div>

            <!-- Pré-visualização 16:9 -->
            <div class="grid-preview-wrapper">
              <div class="grid-preview-inline">
                <div class="grid-preview-content" [ngStyle]="getPreviewGridStyle()">
                  @for (cell of getPreviewCells(); track $index) {
                    <div class="grid-cell-preview"></div>
                  }
                </div>
              </div>
            </div>

            <button 
              class="btn-apply-custom-grid"
              (click)="applyCustomGrid()"
            >
              Aplicar Grade {{ customGridColumns }}×{{ customGridRows }}
            </button>
          </div>
        </div>
      </div>
    }

    <!-- Tab: Elemento -->
    @if (activeTab === 'element') {
      <div class="panel">
        @if (selectedElement) {
          <h4>Propriedades do Elemento</h4>
          
          <!-- Propriedades de Texto -->
          @if (isTextElement(selectedElement)) {
            <div class="property-group">
              <label>Tamanho da Fonte</label>
              <input 
                type="range" 
                min="10" 
                max="72" 
                [value]="$any(selectedElement).fontSize"
                (input)="onFontSizeChange($event)"
                title="Tamanho da fonte"
              >
              <span class="value">{{ $any(selectedElement).fontSize }}px</span>
            </div>

            <div class="property-group">
              <label>Fonte</label>
              <select
                class="font-select"
                [ngModel]="$any(selectedElement).fontFamily"
                (ngModelChange)="onFontFamilyChange($event)"
                title="Fonte"
              >
                @for (font of fontList; track font.value) {
                  <option [value]="font.value" [style.font-family]="font.value">
                    {{ font.name }}
                  </option>
                }
              </select>
            </div>

            <div class="property-group">
              <label>Cor do Texto</label>
              <div class="color-picker-tabs">
                <button 
                  class="color-tab" 
                  [class.active]="textColorTab === 'palette'"
                  (click)="textColorTab = 'palette'"
                >Paleta</button>
                <button 
                  class="color-tab" 
                  [class.active]="textColorTab === 'custom'"
                  (click)="textColorTab = 'custom'"
                >Personalizada</button>
              </div>
              @if (textColorTab === 'palette') {
                <div class="color-palette">
                  @for (color of schoolColorPalette; track color.value) {
                    <button 
                      class="color-swatch" 
                      [style.background-color]="color.value"
                      [class.active]="$any(selectedElement).color === color.value"
                      (click)="onTextColorSelect(color.value)"
                      [title]="color.name"
                      [attr.aria-label]="'Cor ' + color.name"
                    ></button>
                  }
                </div>
              } @else {
                <input 
                  type="color" 
                  [value]="$any(selectedElement).color"
                  (change)="onTextColorChange($event)"
                  title="Cor do texto"
                >
              }
            </div>

            <div class="property-group">
              <label>Cor de Fundo</label>
              <div class="color-picker-tabs">
                <button 
                  class="color-tab" 
                  [class.active]="bgColorTab === 'palette'"
                  (click)="bgColorTab = 'palette'"
                >Paleta</button>
                <button 
                  class="color-tab" 
                  [class.active]="bgColorTab === 'custom'"
                  (click)="bgColorTab = 'custom'"
                >Personalizada</button>
              </div>
              @if (bgColorTab === 'palette') {
                <div class="color-palette">
                  <button 
                    class="color-swatch transparent-swatch" 
                    [class.active]="!$any(selectedElement).backgroundColor || $any(selectedElement).backgroundColor === 'transparent'"
                    (click)="onClearTextBackground()"
                    title="Transparente"
                  ></button>
                  @for (color of schoolColorPalette; track color.value) {
                    <button 
                      class="color-swatch" 
                      [style.background-color]="color.value"
                      [class.active]="$any(selectedElement).backgroundColor === color.value"
                      (click)="onTextBackgroundSelect(color.value)"
                      [title]="color.name"
                      [attr.aria-label]="'Fundo ' + color.name"
                    ></button>
                  }
                </div>
              } @else {
                <div class="color-with-clear">
                  <input 
                    type="color" 
                    [value]="$any(selectedElement).backgroundColor || '#ffffff'"
                    (change)="onTextBackgroundColorChange($event)"
                    title="Cor de fundo do texto"
                  >
                  <button 
                    class="btn-clear"
                    (click)="onClearTextBackground()"
                    title="Remover fundo"
                  >Limpar</button>
                </div>
              }
            </div>

            <div class="property-group">
              <label>Bordas Arredondadas</label>
              <input 
                type="range" 
                min="0" 
                max="50" 
                [value]="$any(selectedElement).border?.radius || 0"
                (input)="onTextBorderRadiusChange($event)"
                title="Arredondamento das bordas"
              >
              <span class="value">{{ $any(selectedElement).border?.radius || 0 }}px</span>
            </div>

            <div class="property-group">
              <label>Alinhamento</label>
              <div class="button-group">
                <button 
                  [class.active]="$any(selectedElement).textAlign === 'left'"
                  (click)="onTextAlignChange('left')"
                  title="Alinhar à esquerda"
                ><span class="material-icons-round">format_align_left</span></button>
                <button 
                  [class.active]="$any(selectedElement).textAlign === 'center'"
                  (click)="onTextAlignChange('center')"
                  title="Centralizar"
                ><span class="material-icons-round">format_align_center</span></button>
                <button 
                  [class.active]="$any(selectedElement).textAlign === 'right'"
                  (click)="onTextAlignChange('right')"
                  title="Alinhar à direita"
                ><span class="material-icons-round">format_align_right</span></button>
              </div>
            </div>

            <div class="property-group">
              <label>
                <input 
                  type="checkbox" 
                  [checked]="$any(selectedElement).fontWeight === 'bold'"
                  (change)="onFontWeightChange($event)"
                >
                Negrito
              </label>
            </div>

            <div class="property-group">
              <label>
                <input 
                  type="checkbox" 
                  [checked]="$any(selectedElement).fontStyle === 'italic'"
                  (change)="onFontStyleChange($event)"
                >
                Itálico
              </label>
            </div>

            <div class="property-group">
              <label>Espaçamento entre linhas</label>
              <input 
                type="range" 
                min="1" 
                max="3" 
                step="0.1"
                [value]="$any(selectedElement).lineHeight || 1.2"
                (input)="onLineHeightChange($event)"
                title="Espaçamento entre linhas"
              >
              <span class="value">{{ ($any(selectedElement).lineHeight || 1.2) | number:'1.1-1' }}x</span>
            </div>
          }

          <!-- Propriedades de Imagem -->
          @if (isImageElement(selectedElement)) {
            <div class="property-group">
              <label>Proporção da Foto</label>
              <div class="aspect-ratio-grid">
                @for (ratio of aspectRatios; track ratio.name) {
                  <button 
                    class="aspect-ratio-btn"
                    [class.active]="getCurrentAspectRatio() === ratio.name"
                    (click)="onAspectRatioChange(ratio.value)"
                    [title]="ratio.name"
                  >
                    <span class="ratio-icon">{{ ratio.icon }}</span>
                    <span class="ratio-label">{{ ratio.name }}</span>
                  </button>
                }
              </div>
            </div>

            <div class="property-group">
              <label>Bordas Arredondadas</label>
              <div class="border-presets">
                <button 
                  class="preset-btn" 
                  [class.active]="getBorderRadius() === 0"
                  (click)="onBorderRadiusPreset(0)"
                  title="Sem arredondamento"
                >⬜</button>
                <button 
                  class="preset-btn" 
                  [class.active]="getBorderRadius() === 12"
                  (click)="onBorderRadiusPreset(12)"
                  title="Levemente arredondado"
                >▢</button>
                <button 
                  class="preset-btn" 
                  [class.active]="getBorderRadius() === 30"
                  (click)="onBorderRadiusPreset(30)"
                  title="Arredondado"
                >◽</button>
                <button 
                  class="preset-btn circular-btn" 
                  [class.active]="isCircular()"
                  (click)="onBorderRadiusPreset(500)"
                  title="Circular / Redondo"
                >⬤</button>
              </div>
              <div class="slider-row">
                <input 
                  type="range" 
                  min="0" 
                  max="500" 
                  [value]="getBorderRadius()"
                  (input)="onBorderRadiusSlider($event)"
                  class="radius-slider"
                >
                <span class="slider-value">{{ getBorderRadius() }}px</span>
              </div>
            </div>

            <div class="property-group">
              <label>Sombra</label>
              <div class="shadow-presets">
                <button 
                  class="shadow-preset-btn"
                  [class.active]="!isShadowEnabled()"
                  (click)="setShadowPreset('none')"
                  title="Sem sombra"
                >
                  <span class="preset-icon">○</span>
                  <span class="preset-name">Nenhuma</span>
                </button>
                <button 
                  class="shadow-preset-btn"
                  [class.active]="isShadowEnabled() && getShadowBlur() <= 10"
                  (click)="setShadowPreset('soft')"
                  title="Sombra suave"
                >
                  <span class="preset-icon">◐</span>
                  <span class="preset-name">Suave</span>
                </button>
                <button 
                  class="shadow-preset-btn"
                  [class.active]="isShadowEnabled() && getShadowBlur() > 10 && getShadowBlur() <= 25"
                  (click)="setShadowPreset('medium')"
                  title="Sombra média"
                >
                  <span class="preset-icon">◑</span>
                  <span class="preset-name">Média</span>
                </button>
                <button 
                  class="shadow-preset-btn"
                  [class.active]="isShadowEnabled() && getShadowBlur() > 25"
                  (click)="setShadowPreset('strong')"
                  title="Sombra forte"
                >
                  <span class="preset-icon">●</span>
                  <span class="preset-name">Forte</span>
                </button>
              </div>

              @if (isShadowEnabled()) {
                <div class="shadow-controls">
                  <div class="shadow-control-row">
                    <label class="small-label">Desfoque</label>
                    <div class="slider-row">
                      <input 
                        type="range" 
                        min="0" 
                        max="50" 
                        [value]="getShadowBlur()"
                        (input)="onShadowBlurChange($event)"
                        class="shadow-slider"
                      >
                      <span class="slider-value">{{ getShadowBlur() }}px</span>
                    </div>
                  </div>

                  <div class="shadow-control-row">
                    <label class="small-label">Direção</label>
                    <div class="direction-grid">
                      <button 
                        class="direction-btn"
                        [class.active]="getShadowDirection() === 'top-left'"
                        (click)="setShadowDirection('top-left')"
                        title="Superior esquerda"
                      >↖</button>
                      <button 
                        class="direction-btn"
                        [class.active]="getShadowDirection() === 'top'"
                        (click)="setShadowDirection('top')"
                        title="Superior"
                      >↑</button>
                      <button 
                        class="direction-btn"
                        [class.active]="getShadowDirection() === 'top-right'"
                        (click)="setShadowDirection('top-right')"
                        title="Superior direita"
                      >↗</button>
                      <button 
                        class="direction-btn"
                        [class.active]="getShadowDirection() === 'left'"
                        (click)="setShadowDirection('left')"
                        title="Esquerda"
                      >←</button>
                      <button 
                        class="direction-btn center-btn"
                        [class.active]="getShadowDirection() === 'center'"
                        (click)="setShadowDirection('center')"
                        title="Central (igual em todos os lados)"
                      >◎</button>
                      <button 
                        class="direction-btn"
                        [class.active]="getShadowDirection() === 'right'"
                        (click)="setShadowDirection('right')"
                        title="Direita"
                      >→</button>
                      <button 
                        class="direction-btn"
                        [class.active]="getShadowDirection() === 'bottom-left'"
                        (click)="setShadowDirection('bottom-left')"
                        title="Inferior esquerda"
                      >↙</button>
                      <button 
                        class="direction-btn"
                        [class.active]="getShadowDirection() === 'bottom'"
                        (click)="setShadowDirection('bottom')"
                        title="Inferior"
                      >↓</button>
                      <button 
                        class="direction-btn"
                        [class.active]="getShadowDirection() === 'bottom-right'"
                        (click)="setShadowDirection('bottom-right')"
                        title="Inferior direita"
                      >↘</button>
                    </div>
                  </div>

                  <div class="shadow-control-row">
                    <label class="small-label">Cor da Sombra</label>
                    <div class="shadow-color-options">
                      <button 
                        class="color-btn"
                        [class.active]="getShadowColor() === 'rgba(0,0,0,0.3)'"
                        (click)="setShadowColor('rgba(0,0,0,0.3)')"
                        style="background: rgba(0,0,0,0.5)"
                        title="Preto"
                      ></button>
                      <button 
                        class="color-btn"
                        [class.active]="getShadowColor() === 'rgba(0,0,0,0.6)'"
                        (click)="setShadowColor('rgba(0,0,0,0.6)')"
                        style="background: rgba(0,0,0,0.8)"
                        title="Preto forte"
                      ></button>
                      <button 
                        class="color-btn"
                        [class.active]="getShadowColor() === 'rgba(59,130,246,0.4)'"
                        (click)="setShadowColor('rgba(59,130,246,0.4)')"
                        style="background: rgba(59,130,246,0.7)"
                        title="Azul"
                      ></button>
                      <button 
                        class="color-btn"
                        [class.active]="getShadowColor() === 'rgba(168,85,247,0.4)'"
                        (click)="setShadowColor('rgba(168,85,247,0.4)')"
                        style="background: rgba(168,85,247,0.7)"
                        title="Roxo"
                      ></button>
                      <button 
                        class="color-btn"
                        [class.active]="getShadowColor() === 'rgba(236,72,153,0.4)'"
                        (click)="setShadowColor('rgba(236,72,153,0.4)')"
                        style="background: rgba(236,72,153,0.7)"
                        title="Rosa"
                      ></button>
                      <button 
                        class="color-btn"
                        [class.active]="getShadowColor() === 'rgba(34,197,94,0.4)'"
                        (click)="setShadowColor('rgba(34,197,94,0.4)')"
                        style="background: rgba(34,197,94,0.7)"
                        title="Verde"
                      ></button>
                    </div>
                  </div>
                </div>
              }
            </div>

            @if ($any(selectedElement).orderNumber) {
              <div class="property-group">
                <label>Ordem da Imagem</label>
                <span class="value">#{{ $any(selectedElement).orderNumber }}</span>
              </div>
            }
          }

          <!-- Seção de Animação -->
          <div class="property-group">
            <label>
              <span class="material-icons" style="font-size: 16px; vertical-align: middle;">animation</span>
              Animação
            </label>
            
            <div class="animation-select">
              <select 
                [value]="getAnimationType()"
                (change)="onAnimationTypeChange($event)"
                class="select-animation"
              >
                <optgroup label="Básicas">
                  <option value="none">Nenhuma</option>
                  <option value="fadeIn">Aparecer (Fade In)</option>
                  <option value="fadeInUp">Aparecer de baixo</option>
                  <option value="fadeInDown">Aparecer de cima</option>
                  <option value="fadeInLeft">Aparecer da esquerda</option>
                  <option value="fadeInRight">Aparecer da direita</option>
                </optgroup>
                <optgroup label="Zoom">
                  <option value="zoomIn">Zoom In</option>
                  <option value="zoomOut">Zoom Out</option>
                </optgroup>
                <optgroup label="Deslizar">
                  <option value="slideInUp">Deslizar de baixo</option>
                  <option value="slideInDown">Deslizar de cima</option>
                  <option value="slideInLeft">Deslizar da esquerda</option>
                  <option value="slideInRight">Deslizar da direita</option>
                </optgroup>
                <optgroup label="Rotação">
                  <option value="flipInX">Virar horizontal</option>
                  <option value="flipInY">Virar vertical</option>
                  <option value="rotateIn">Rotacionar</option>
                </optgroup>
                <optgroup label="Especiais">
                  <option value="bounceIn">Quicar</option>
                  <option value="pulse">Pulsar</option>
                  <option value="shake">Tremer</option>
                  <option value="swing">Balançar</option>
                </optgroup>
                @if (selectedElement.type === 'text') {
                  <optgroup label="Texto">
                    <option value="typewriter">Máquina de escrever</option>
                    <option value="letterByLetter">Letra por letra</option>
                    <option value="wordByWord">Palavra por palavra</option>
                    <option value="highlight">Destacar</option>
                    <option value="glitch">Glitch</option>
                  </optgroup>
                }
              </select>
            </div>

            @if (getAnimationType() !== 'none') {
              <div class="animation-controls">
                <div class="animation-control-row">
                  <label class="small-label">Duração</label>
                  <div class="slider-row">
                    <input 
                      type="range" 
                      min="0.1" 
                      max="3" 
                      step="0.1"
                      [value]="getAnimationDuration()"
                      (input)="onAnimationDurationChange($event)"
                      class="animation-slider"
                    >
                    <span class="slider-value">{{ getAnimationDuration() }}s</span>
                  </div>
                </div>

                <div class="animation-control-row">
                  <label class="small-label">Iniciar</label>
                  <select 
                    [value]="getAnimationStartTrigger()"
                    (change)="onAnimationStartTriggerChange($event)"
                    class="select-easing"
                  >
                    <option value="onClick">Ao clicar</option>
                    <option value="withPrevious">Com a anterior</option>
                    <option value="afterPrevious">Após a anterior</option>
                  </select>
                </div>

                <div class="animation-control-row">
                  <label class="small-label">Ordem</label>
                  <div class="slider-row">
                    <input 
                      type="number" 
                      min="1" 
                      max="99"
                      [value]="getAnimationOrder()"
                      (input)="onAnimationOrderChange($event)"
                      class="animation-order-input"
                    >
                  </div>
                </div>

                <div class="animation-control-row">
                  <label class="small-label">Atraso extra</label>
                  <div class="slider-row">
                    <input 
                      type="range" 
                      min="0" 
                      max="5" 
                      step="0.1"
                      [value]="getAnimationDelay()"
                      (input)="onAnimationDelayChange($event)"
                      class="animation-slider"
                    >
                    <span class="slider-value">{{ getAnimationDelay() }}s</span>
                  </div>
                </div>

                <div class="animation-control-row">
                  <label class="small-label">Suavização</label>
                  <select 
                    [value]="getAnimationEasing()"
                    (change)="onAnimationEasingChange($event)"
                    class="select-easing"
                  >
                    <option value="linear">Linear</option>
                    <option value="ease">Suave</option>
                    <option value="ease-in">Acelerar</option>
                    <option value="ease-out">Desacelerar</option>
                    <option value="ease-in-out">Suave ambos</option>
                  </select>
                </div>

                <div class="animation-control-row">
                  <label class="checkbox-label">
                    <input 
                      type="checkbox" 
                      [checked]="getAnimationRepeat()"
                      (change)="onAnimationRepeatChange($event)"
                    >
                    Repetir animação
                  </label>
                </div>

                <button class="btn-preview-animation" (click)="previewAnimation()">
                  <span class="material-icons">play_arrow</span>
                  Pré-visualizar
                </button>
              </div>
            }
          </div>

          <div class="property-group">
            <label>Posição</label>
            <div class="position-info">
              <span>X: {{ selectedElement.position.x | number:'1.0-0' }}%</span>
              <span>Y: {{ selectedElement.position.y | number:'1.0-0' }}%</span>
            </div>
            <div class="position-info">
              <span>W: {{ selectedElement.position.width | number:'1.0-0' }}%</span>
              <span>H: {{ selectedElement.position.height | number:'1.0-0' }}%</span>
            </div>
          </div>

          <!-- Botão Excluir Elemento -->
          <div class="property-group delete-section">
            <button 
              class="btn-delete-element"
              (click)="onDeleteElement()"
              title="Excluir este elemento"
            >
              <span class="material-icons-round">delete</span> Excluir Elemento
            </button>
          </div>
        } @else {
          <p class="no-selection">Selecione um elemento para editar</p>
        }
      </div>
    }

    <!-- Tab: Slide -->
    @if (activeTab === 'slide') {
      <div class="panel">
        <h4>Configurações do Slide</h4>
        
        @if (slideService.currentSlide(); as slide) {
          <!-- Duração do Slide -->
          <div class="property-group">
            <label>
              <span class="material-icons-round property-icon">schedule</span>
              Duração do Slide
            </label>
            <div class="duration-control">
              <input 
                type="range" 
                min="1" 
                max="30" 
                step="1"
                [value]="slide.duration || 5"
                (input)="onSlideDurationChange($event)"
                class="duration-slider"
              >
              <div class="duration-value">
                <input 
                  type="number" 
                  min="1" 
                  max="60"
                  [value]="slide.duration || 5"
                  (change)="onSlideDurationChange($event)"
                  class="duration-input"
                >
                <span>seg</span>
              </div>
            </div>
            <button 
              class="btn-apply-all-duration"
              (click)="onApplyDurationToAll(slide.duration || 5)"
              title="Aplicar esta duração a todos os slides"
            >
              <span class="material-icons-round">done_all</span>
              Aplicar a todos
            </button>
          </div>

          <!-- Transição do Slide -->
          <div class="property-group">
            <label>
              <span class="material-icons-round property-icon">animation</span>
              Transição de Entrada
            </label>
            <div class="transition-grid">
              @for (transition of transitionTypes; track transition.id) {
                <div 
                  class="transition-item"
                  [class.active]="(slide.transition?.type || 'none') === transition.id"
                  (click)="onTransitionChange(transition.id)"
                  [title]="transition.name"
                >
                  <span class="transition-icon material-icons-round">{{ transition.icon }}</span>
                  <span class="transition-name">{{ transition.name }}</span>
                </div>
              }
            </div>
          </div>

          <!-- Velocidade da Transição -->
          @if (slide.transition?.type && slide.transition!.type !== 'none') {
            <div class="property-group">
              <label>Velocidade da Transição</label>
              <div class="transition-speed-control">
                <input 
                  type="range" 
                  min="0.2" 
                  max="2" 
                  step="0.1"
                  [value]="slide.transition?.duration || 0.5"
                  (input)="onTransitionDurationChange($event)"
                  class="transition-speed-slider"
                >
                <span class="transition-speed-value">{{ (slide.transition?.duration || 0.5).toFixed(1) }}s</span>
              </div>
              <button 
                class="btn-apply-all-transition"
                (click)="onApplyTransitionToAll()"
                title="Aplicar esta transição a todos os slides"
              >
                <span class="material-icons-round">done_all</span>
                Aplicar a todos
              </button>
            </div>
          }

          <div class="separator-line"></div>

          <div class="property-group">
            <label>Cor de Fundo</label>
            <input 
              type="color" 
              [value]="slide.backgroundColor"
              (change)="onBackgroundColorChange($event)"
              title="Cor de fundo do slide"
            >
          </div>

          <div class="property-group">
            <label>Imagem de Fundo</label>
            
            <div class="theme-list">
              @for (theme of backgroundThemes; track theme.id) {
                <div 
                  class="theme-item"
                  [class.selected]="isThemeSelected(theme.id)"
                  (click)="onSelectBackgroundTheme(theme)"
                >
                  <div 
                    class="theme-preview" 
                    [style.background]="getThemePreviewStyle(theme)"
                  ></div>
                  <div class="theme-info">
                    <span class="theme-name">{{ theme.name }}</span>
                    <span class="theme-desc">{{ theme.description }}</span>
                  </div>
                  @if (theme.isUserAdded) {
                    <button 
                      class="btn-remove-theme"
                      (click)="removeCustomTheme(theme, $event)"
                      title="Remover tema"
                    ><span class="material-icons">close</span></button>
                  }
                  @if (isThemeSelected(theme.id)) {
                    <span class="theme-check material-icons">check</span>
                  }
                </div>
              }
            </div>

            <div class="theme-actions">
              <button 
                class="btn-add-image"
                (click)="openAddImageModal()"
              >
                + Adicionar Imagem
              </button>
              <button 
                class="btn-apply-all-simple"
                (click)="onApplyBackgroundThemeToAll()"
                [disabled]="!lastSelectedTheme"
              >
                Aplicar em todos
              </button>
            </div>
          </div>

          <div class="property-group">
            <label>Nome do Slide</label>
            <input 
              type="text" 
              class="slide-name-input value"
              [value]="slide.name"
              (input)="onSlideNameChange($event)"
              title="Nome do slide"
              placeholder="Nome do slide"
            >
          </div>

          <div class="property-group">
            <label>Elementos</label>
            <span class="value">{{ slide.elements.length }}</span>
          </div>
        }
      </div>
    }
  </div>
</div>

<!-- Modal: Adicionar Imagem de Fundo -->
@if (showAddImageModal) {
  <div class="modal-overlay" (click)="closeAddImageModal()">
    <div class="add-image-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Adicionar Imagem de Fundo</h3>
        <button class="btn-close-modal" (click)="closeAddImageModal()"><span class="material-icons">close</span></button>
      </div>
      
      <div class="modal-body">
        <div class="form-group">
          <label>Imagem</label>
          <div class="image-upload-area">
            @if (newImagePreview) {
              <img [src]="newImagePreview" class="image-preview" alt="Preview">
            } @else {
              <div class="upload-placeholder">
                <span class="upload-icon material-icons">add_photo_alternate</span>
                <span>Clique para selecionar</span>
              </div>
            }
            <input 
              type="file" 
              accept="image/*"
              class="file-input"
              (change)="onNewImageFileSelect($event)"
              title="Selecionar imagem"
            >
          </div>
        </div>

        <div class="form-group">
          <label>Nome do Tema *</label>
          <input 
            type="text" 
            class="form-input"
            [(ngModel)]="newImageName"
            placeholder="Ex: Natureza, Praia, Floresta..."
          >
        </div>

        <div class="form-group">
          <label>Descrição</label>
          <input 
            type="text" 
            class="form-input"
            [(ngModel)]="newImageDescription"
            placeholder="Descrição opcional do tema"
          >
        </div>
      </div>

      <div class="modal-footer">
        <button 
          class="btn-cancel"
          (click)="closeAddImageModal()"
        >Cancelar</button>
        <button 
          class="btn-confirm"
          [disabled]="!newImageName.trim() || !newImageData"
          (click)="confirmAddImage()"
        >Adicionar</button>
      </div>
    </div>
  </div>
}
