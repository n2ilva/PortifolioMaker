<div class="presentation-overlay" *ngIf="isOpen" (click)="nextSlide()">
  <!-- Slide Content -->
  <div 
    class="presentation-slide" 
    *ngIf="currentSlide" 
    [attr.data-animation-key]="getAnimationKey()"
    [ngClass]="transitionClass"
    [class.transitioning]="isTransitioning"
    [style.animation-duration]="isTransitioning ? transitionDuration + 's' : null"
  >
    <!-- Background Color -->
    <div 
      class="slide-background" 
      [style.background-color]="currentSlide.backgroundColor"
    ></div>
    
    <!-- Elements -->
    <ng-container *ngFor="let element of currentSlide.elements">
      <!-- Image Element -->
      <div 
        *ngIf="isImage(element)" 
        class="presentation-element {{ getAnimationClasses(element) }}"
        [class.background-element]="element.metadata?.['backgroundDecor']"
        [ngStyle]="getElementStyle(element)"
        [style.animation-duration]="element.animation?.type !== 'none' ? element.animation?.duration + 's' : null"
        [style.animation-delay]="element.animation?.type !== 'none' ? element.animation?.delay + 's' : null"
        [style.animation-timing-function]="element.animation?.type !== 'none' ? element.animation?.easing : null"
      >
        <img [src]="element.src" [alt]="element.alt" [title]="element.alt || 'Imagem'" [ngStyle]="getImageStyle(element)">
      </div>
      
      <!-- Text Element -->
      <div 
        *ngIf="isText(element)" 
        class="presentation-element presentation-text {{ getAnimationClasses(element) }}"
        [ngStyle]="getElementStyle(element)"
        [style.animation-duration]="element.animation?.type !== 'none' && !isTextAnimation(element) ? element.animation?.duration + 's' : null"
        [style.animation-delay]="element.animation?.type !== 'none' && !isTextAnimation(element) ? element.animation?.delay + 's' : null"
        [style.animation-timing-function]="element.animation?.type !== 'none' && !isTextAnimation(element) ? element.animation?.easing : null"
      >
        <!-- Animação: Letra por Letra -->
        <span *ngIf="element.animation?.type === 'letterByLetter'" [ngStyle]="getTextStyle(element)" class="text-animation-container">
          <span 
            *ngFor="let letter of getLetters(element.content); let i = index"
            class="animated-letter"
            [style.animation-delay]="getCharDelay(i, element)"
            [style.animation-timing-function]="element.animation?.easing"
          >{{ letter === ' ' ? '\u00A0' : letter }}</span>
        </span>

        <!-- Animação: Palavra por Palavra -->
        <span *ngIf="element.animation?.type === 'wordByWord'" [ngStyle]="getTextStyle(element)" class="text-animation-container">
          <span 
            *ngFor="let word of getWords(element.content); let i = index; let last = last"
            class="animated-word"
            [style.animation-delay]="getWordDelay(i, element)"
            [style.animation-timing-function]="element.animation?.easing"
          >{{ word }}{{ !last ? '\u00A0' : '' }}</span>
        </span>

        <!-- Animação: Máquina de Escrever -->
        <span *ngIf="element.animation?.type === 'typewriter'" [ngStyle]="getTextStyle(element)" class="typewriter-container">
          <span 
            class="typewriter-text"
            [style.animation-duration]="element.animation?.duration + 's'"
            [style.animation-delay]="element.animation?.delay + 's'"
            [style.animation-timing-function]="'steps(' + element.content.length + ', end)'"
          >{{ element.content }}</span>
          <span 
            class="typewriter-cursor"
            [style.animation-delay]="element.animation?.delay + 's'"
          >|</span>
        </span>

        <!-- Animação: Highlight -->
        <span *ngIf="element.animation?.type === 'highlight'" [ngStyle]="getTextStyle(element)" class="highlight-container">
          <span 
            class="highlight-text"
            [style.animation-duration]="element.animation?.duration + 's'"
            [style.animation-delay]="element.animation?.delay + 's'"
            [style.animation-timing-function]="element.animation?.easing"
          >{{ element.content }}</span>
        </span>

        <!-- Animação: Glitch -->
        <span *ngIf="element.animation?.type === 'glitch'" [ngStyle]="getTextStyle(element)" class="glitch-container" [attr.data-text]="element.content">
          <span 
            class="glitch-text"
            [style.animation-duration]="element.animation?.duration + 's'"
            [style.animation-delay]="element.animation?.delay + 's'"
            [class.animate-repeat]="element.animation?.repeat"
          >{{ element.content }}</span>
        </span>

        <!-- Texto Normal (sem animação especial de texto) -->
        <span 
          *ngIf="!element.animation || element.animation.type === 'none' || !isTextAnimation(element)" 
          [ngStyle]="getTextStyle(element)"
        >{{ element.content }}</span>
      </div>
    </ng-container>
  </div>

  <!-- Controls -->
  <div class="presentation-controls" [class.visible]="showControls" (click)="$event.stopPropagation()">
    <!-- Top Bar -->
    <div class="top-bar">
      <!-- Botão de Auto Play -->
      <button 
        class="autoplay-btn" 
        [class.playing]="isAutoPlaying"
        (click)="toggleAutoPlay()" 
        [title]="isAutoPlaying ? 'Pausar (P)' : 'Reprodução automática (P)'"
      >
        <span class="material-icons">{{ isAutoPlaying ? 'pause' : 'play_arrow' }}</span>
        @if (isAutoPlaying && timeRemaining > 0) {
          <span class="autoplay-countdown">{{ timeRemaining }}s</span>
        }
      </button>
      
      <button class="close-btn" (click)="close()" title="Sair (ESC)">
        <span class="material-icons">close</span>
      </button>
    </div>
    
    <!-- Barra de progresso do autoplay -->
    @if (isAutoPlaying) {
      <div class="autoplay-progress-bar">
        <div 
          class="autoplay-progress-fill"
          [style.animation-duration]="currentSlideDuration + 's'"
        ></div>
      </div>
    }

    <!-- Navigation Arrows -->
    <button 
      class="nav-btn prev-btn" 
      (click)="prevSlide(); $event.stopPropagation()"
      [disabled]="currentSlideIndex === 0"
      title="Slide anterior"
    >
      ‹
    </button>
    
    <button 
      class="nav-btn next-btn" 
      (click)="nextSlide(); $event.stopPropagation()"
      [disabled]="currentSlideIndex === totalSlides - 1"
      title="Próximo slide"
    >
      ›
    </button>

    <!-- Bottom Bar -->
    <div class="bottom-bar">
      <!-- Slide Counter -->
      <div class="slide-counter">
        {{ currentSlideIndex + 1 }} / {{ totalSlides }}
        @if (currentSlide && currentSlide.duration) {
          <span class="slide-duration-info">({{ currentSlide.duration }}s)</span>
        }
      </div>

      <!-- Slide Thumbnails -->
      <div class="slide-dots">
        <button 
          *ngFor="let slide of slideService.slides(); let i = index"
          class="slide-dot"
          [class.active]="i === currentSlideIndex"
          (click)="goToSlide(i); $event.stopPropagation()"
          [title]="'Slide ' + (i + 1)"
        ></button>
      </div>

      <!-- Keyboard Hint -->
      <div class="keyboard-hint">
        Use ← → ou clique • P para auto play • ESC para sair
      </div>
    </div>
  </div>
</div>
